<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>
</head>

<body>
    <h1>Bubble map</h1>

    <svg id="my_dataviz" width="1200" height="630"></svg>

    <script>
        // The svg
        const svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        // Map and projection
        const projection = d3.geoMercator()
            .center([0, 20]) // GPS of location to zoom on
            .scale(150)       // This is like the zoom
            .translate([width / 2, height / 2]);

        // Load bubble data
        d3.csv("/src/bubble_dataset.csv").then(function(data) {

            // Show the map
            d3.json("/src/world.geojson").then(function(dataGeo) {
                svg.append("g")
                    .selectAll("path")
                    .data(dataGeo.features)
                    .join("path")
                        .attr("fill", "#b8b8b8")
                        .attr("d", d3.geoPath()
                            .projection(projection)
                        )
                    .style("stroke", "none")
                    .style("opacity", .3)
            });

            const filteredData = data.filter(d => +d.year === 2015);

            const color = d3.scaleOrdinal()
                .domain(filteredData.map(d => d.country_name))
                .range(d3.schemePaired);
            
            const valueExtent = d3.extent(filteredData, d => +d.song_count);

            const size = d3.scaleSqrt()
                .domain(valueExtent)
                .range([2, 20]);

            // Add bubbles for the filtered data
            svg.selectAll("circle")
                .data(filteredData)
                .enter()
                .append("circle")
                .attr("cx", d => projection([d.x, d.y])[0])
                .attr("cy", d => projection([d.x, d.y])[1])
                .attr("r", d => size(+d.song_count))
                .style("fill", d => color(d.country_name));
        });
    </script>

</body>
</html>